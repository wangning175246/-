> https://github.com/owenliang/crontab

#### 任务调度系统

![image-20200513182425257](images\任务调度\image-20200513182425257.png)

WebConsole 是前端页面

JobMgr 任务管理，任务保存到Etcd中，实时同步到work节点

日志会保存到MongoDB中，

## 基本架构介绍

![image-20200516100305886](images\任务调度\image-20200516100305886.png)

#### 无状态master集群，

- 保存任务
- 查询任务
- 查询日志

#### ETCD 

主要是用来存储任务列表，

#### MongoDB

主要是用来存储任务的执行日志

#### Workd节点

从etcd中获取所有任务列表，而后执行任务，执行任务的时候，需要创建一个分布式锁，避免多个节点同时执行一个任务，任务执行完成后把日志写入MongoDB中，

任务调度：基于cron表达式计算，触发过期任务，

![image-20200516101510023](images\任务调度\image-20200516101510023.png)

日志协程：启动一个batch(批处理)，设置可以缓冲区可以存放最大N条日志，并且每隔1s提交一次任务，或者任务缓冲区满了提交任务。

